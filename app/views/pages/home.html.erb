<% if user_signed_in? %>
  <div class="container">
    <div class="profile">
      <div class="title">
        <h1><%= current_user.company.capitalize %> > <%= current_user.first_name.capitalize %> <%= current_user.last_name.capitalize %> </h1>
      </div>
      <div class="user">
         <p><%= current_user.city.capitalize %>, <%= current_user.state.capitalize %></p>
         <%= current_user.field %>
        <p><%= current_user.tag %></p>
        <p><%= current_user.bio %></p>
        <p><%= current_user.website %></p>
      </div>
    </div>

    <div class="teams-list-container">
        <button type="button" class="btn btn-primary team-create-btn" data-toggle="modal"    data-target="#team-create-modal">
         Create a Team
        </button>
      <h2> <%= current_user.first_name  %>'s teams</h2>
      <div class="teams-list">
        <% current_user.teams.each do |team| %>
          <div class="team-card">
            <h3><%= "#{team.name}"  %></h3>
            <%= link_to "Manage Team", team_path(team.id), class: "btn btn-primary" %>
          </div>
        <% end %>
      </div>
    </div>

    <div class="projects-list-container">
      <button type="button" class="btn btn-primary project-create-btn" data-toggle="modal"  data-target="#project-create-modal">
        Create a Project
      </button>
      <h2> <%= current_user.first_name  %>'s projects</h2>



      <div class="projects-list">
        <% current_user.teams.each do |team| %>
          <% team.projects.each do |project| %>
            <div class="project-card">
              <h3><%= "#{project.name}" %></h3>
              <div class="project-card-actions">
                <%= link_to "Go To Project", project_path(project.id), class: "btn btn-primary" %>
                <%= link_to "Delete Project", project, method: :delete, class: "btn btn-primary" %>
              </div>
              <div class="progress">

                 <p>Project <%= project.project_progress %>%</p>


                  <% project.stages.each do |stage| %>
                    <% if stage.checklists.exists? %>

                        <p><%= stage.name %> progress <%=stage.stage_progress %>%</p>

                    <% else %>

                        <p><%= stage.name %> progress 0% </p>

                    <% end %>
                  <% end %>

                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
    <div class="modal fade" id="team-create-modal" tabindex="-1" role="dialog" aria-labelledby="team-create-modal" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
            <%=render template: "teams/new"  %>
        </div>
      </div>
    </div>

    <div class="modal fade" id="project-create-modal" tabindex="-1" role="dialog" aria-labelledby="project-create-modal" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
            <%=render template: "projects/new"  %>

        </div>
      </div>

<% else %>
  <div class="container">
    <h1>Welcome to Cinemakers</h1>
    <%= link_to "Login", new_user_session_path, class: " btn btn-primary" %>
  </div>
<% end %>


</div>

